{% extends "base.html" %}

{% block title %}Index{% endblock title %}

{% block main %}
<div class="container">
    <div class="row">
        <div class="col">
            <h1>XR18 Recorder</h1>
            <div class="btn-group" role="group" aria-label="recorder control">
                <button type="button" class="btn btn-lg btn-danger" id="record-btn" name="record-btn">Record</button>
                <button type="button" class="btn btn-lg btn-secondary" id="stop-btn" name="stop-btn">Stop</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <textarea id="stdout-area" name="stdout-area" rows="10" cols="120" readonly>
            </textarea>
        </div>
    </div>
</div>
{% endblock main %}

{% block script %}
<script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('cmd_line_output', (data) => {
        console.log(data);
        var $textarea = $('#stdout-area');
        $textarea.append(data.stdout);
        $textarea.scrollTop($textarea[0].scrollHeight);

    });
    
    $(document).ready(function(){
        var $textarea = $('#stdout-area');
        $textarea.scrollTop($textarea[0].scrollHeight);
    });

    $('#record-btn').click( () => {
        fetch("/api/rec")
        .then( (data) => {
            $('#stdout-area').text(data)
        })
    });

    $('#stop-btn').click( () => {
        fetch("/api/stop");
    });
</script>
{% endblock script %}